# GreenIoT-Ansible

This repository contains an Ansible playbook created to build and deploy a prototype system to collect, store, and make available the sensor data from the [GreenIoT project](http://user.it.uu.se/~eding810/GreenIoT/).


The prototype is built from three different github repositories: [GreenIoT-MQTT-Tagger](https://github.com/jfjallid/GreenIoT-MQTT-Tagger), [GreenIoT-SenML-Parser](https://github.com/jfjallid/GreenIoT-SenML-Parser), and [GreenIoT-GraphQL-Demo](https://github.com/jfjallid/GreenIoT-GraphQL-Demo).


This playbook is designed to work on Ubuntu 18.04.  
It will install docker and deploy the prototype and database as docker containers.  
The containers include an elasticsearch cluster which will be deployed exposing port 9200, and a web server exposing port 80.


The two files `playbook.yml` and `hosts` contains the config that needs to be customized before using this playbook.  
In `playbook.yml`:  
The variable `user`should be set to a user account with sudo privilege and ssh access to the target machine.  
The variable user_pass should be set to an ansible-vault encrypted string of the `user` password.  
This encrypted string can be generated by running the command: `ansible-vault encrypt_string`, followed by a user-defined vault password, and then the actual password. Replace the value of the `user_pass`variable with the output from that command. The current default password is **ubuntu**, and the vault secret is **secret**.  
The variable `main_directory` can be changed to whatever path ansible should use to store the project files.


In `hosts`:  
The variable: `ansible_host=127.0.0.1` should contain the ip address of the target machine.


To run the playbook:  
`ansible-playbook --ask-vault-pass -i hosts playbook.yml --tags docker,elastic,mqtt-to-elastic`  
The pass that is asked for is the user-defined ansible vault password, e.g., **secret** if unchanged.  
Some other tags that can be used include: `elastic-remove` to delete the elastic cluster and data volumes, and `mqtt-to-elastic-rebuild` to recreate the container without pulling updates from github.